{"version":3,"file":"events.min.js","sources":["../src/events.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @module   local_syllabusuploader\n * @copyright 2023 onwards Louisiana State University\n * @copyright 2023 onwards David Lowe, Robert Russo\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\n define([\n    'jquery',\n    'local_syllabusuploader/notifications',\n    'local_syllabusuploader/su_lib',\n    'local_syllabusuploader/file_buttons'\n], function($, noti, SULib, FB) {\n    'use strict';\n    return {\n        /**\n         * Register click events for the system files page. If the template is reloaded\n         * for the system files then the events need to called again. This will be called\n         * from the template file.\n         *\n         * @return void\n         */\n        registerSysFileEvents: function () {\n            // --------------------------------\n            // Delete NON Moodle File.\n            // --------------------------------\n            SULib.preLoadConfig();\n            if (sessionStorage.getItem('debugging') === \"true\") {\n                console.log(\" ********** registerSysFileEvents START ***********\");\n            }\n            $('.local_syllabusuploader_container .nonmood_file_delete').on('click', function(ev) {\n                ev.preventDefault();\n\n                var row_data = {\n                    \"record\": $(this).closest(\"tr\").data(\"rowid\"),\n                    \"title\": 'Delete File',\n                    \"body\": 'Are you sure you want to delete this file?',\n                    \"save_button\": \"Yes\"\n                };\n                noti.callYesNoModi(row_data).then(function (response) {\n                    if (response.status == true) {\n                        var this_form = $('#nonmood_file_form');\n                        $('.nonmood_file_form_'+response.data.record+' > input').each(function(idx, item) {\n                            this_form.append('<input type=\"hidden\" ' +\n                                'name=\"' + $(item).attr(\"name\") + '\" ' +\n                                'value = \"'+ $(item).attr(\"value\") + '\" />');\n                        });\n                        this_form.append('<input type=\"hidden\" name=\"action\" value=\"delete\" />');\n                        this_form.submit();\n                        // SULib.get_file_list(response).then(function (response) {\n                        //     Refresh.refreshGeneralFiles(response);\n                        // });\n                    }\n                });\n            });\n        },\n        /**\n         * Register click events for the page.\n         *\n         * @return void\n         */\n        registerMooFileEvents: function () {\n            // --------------------------------\n            // Copy File.\n            // --------------------------------\n            if (sessionStorage.getItem('debugging') === \"true\") {\n                console.log(\" ********** registerMooFileEvents START ***********\");\n            }\n\n            $('.local_syllabusuploader_container .syllabusuploader_file_copy').on('click', function(ev) {\n                ev.preventDefault();\n\n                var row_data = {\n                    \"record\": $(this).closest(\"tr\").data(\"rowid\"),\n                    \"this_form\": $(this).closest(\"form\"),\n                    \"title\": 'Copy File',\n                    \"body\": 'Copy file to location defined in settings?',\n                    \"save_button\": \"Copy\",\n                    \"mfileid\": $(this).closest(\"tr\").find('input[name=mdl_file_id]').val()\n                };\n                if (sessionStorage.getItem('debugging') === \"true\") {\n                    console.log(\"Debugging: Data being sent to confirm check is: \", row_data);\n                }\n                FB.confirmCheckExecute(row_data);\n            });\n\n            // --------------------------------\n            // Delete Moodle File.\n            // --------------------------------\n            $('body .local_syllabusuploader_container .syllabusuploader_file_delete').on('click', function(ev) {\n                ev.preventDefault();\n\n                var row_data = {\n                    \"record\": $(this).closest(\"tr\").data(\"rowid\"),\n                    \"title\": 'Delete File',\n                    \"body\": 'Are you sure you want to delete this file?',\n                    \"save_button\": \"Yes\"\n                };\n                noti.callYesNoModi(row_data).then(function (response) {\n                    if (response.status == true) {\n                        var this_form = $('#syllabusuploader_file_form_' + response.data.record);\n                        // Convert all the form elements values to a serialised string.\n                        this_form.append('<input type=\"hidden\" name=\"action\" value=\"delete\" />');\n                        this_form.submit();\n                    }\n                });\n            });\n\n            //Bind keypress event to document\n            $(document).keypress(function(event){\n                var keycode = (event.keyCode ? event.keyCode : event.which);\n                if(keycode == '13'){\n                    if ($('.justdoitnow').length) {\n                        $('.justdoitnow').parent().next().find('.btn.btn-primary').click();\n                    }\n                }\n            });\n        },\n\n        /**\n         * Currently this is being called from the mustache templates when viewing lists.\n         * @param null\n         * @return void\n         */\n        // init: function() {\n        //     var that = this;\n        //     // Register events.\n        //     that.registerMooFileEvents();\n        // },\n    };\n});\n"],"names":["define","$","noti","SULib","FB","registerSysFileEvents","preLoadConfig","sessionStorage","getItem","console","log","on","ev","preventDefault","row_data","this","closest","data","callYesNoModi","then","response","status","this_form","record","each","idx","item","append","attr","submit","registerMooFileEvents","find","val","confirmCheckExecute","document","keypress","event","keyCode","which","length","parent","next","click"],"mappings":";;;;;;AAsBCA,uCAAO,CACJ,SACA,uCACA,gCACA,wCACD,SAASC,EAAGC,KAAMC,MAAOC,UAEjB,CAQHC,sBAAuB,WAInBF,MAAMG,gBACsC,SAAxCC,eAAeC,QAAQ,cACvBC,QAAQC,IAAI,uDAEhBT,EAAE,0DAA0DU,GAAG,SAAS,SAASC,IAC7EA,GAAGC,qBAECC,SAAW,QACDb,EAAEc,MAAMC,QAAQ,MAAMC,KAAK,eAC5B,mBACD,yDACO,OAEnBf,KAAKgB,cAAcJ,UAAUK,MAAK,SAAUC,aACjB,GAAnBA,SAASC,OAAgB,KACrBC,UAAYrB,EAAE,sBAClBA,EAAE,sBAAsBmB,SAASH,KAAKM,OAAO,YAAYC,MAAK,SAASC,IAAKC,MACxEJ,UAAUK,OAAO,8BACF1B,EAAEyB,MAAME,KAAK,QADX,cAEA3B,EAAEyB,MAAME,KAAK,SAAW,WAE7CN,UAAUK,OAAO,wDACjBL,UAAUO,iBAa1BC,sBAAuB,WAIyB,SAAxCvB,eAAeC,QAAQ,cACvBC,QAAQC,IAAI,uDAGhBT,EAAE,iEAAiEU,GAAG,SAAS,SAASC,IACpFA,GAAGC,qBAECC,SAAW,QACDb,EAAEc,MAAMC,QAAQ,MAAMC,KAAK,mBACxBhB,EAAEc,MAAMC,QAAQ,cACpB,iBACD,yDACO,eACJf,EAAEc,MAAMC,QAAQ,MAAMe,KAAK,2BAA2BC,OAEzB,SAAxCzB,eAAeC,QAAQ,cACvBC,QAAQC,IAAI,mDAAoDI,UAEpEV,GAAG6B,oBAAoBnB,aAM3Bb,EAAE,wEAAwEU,GAAG,SAAS,SAASC,IAC3FA,GAAGC,qBAECC,SAAW,QACDb,EAAEc,MAAMC,QAAQ,MAAMC,KAAK,eAC5B,mBACD,yDACO,OAEnBf,KAAKgB,cAAcJ,UAAUK,MAAK,SAAUC,aACjB,GAAnBA,SAASC,OAAgB,KACrBC,UAAYrB,EAAE,+BAAiCmB,SAASH,KAAKM,QAEjED,UAAUK,OAAO,wDACjBL,UAAUO,gBAMtB5B,EAAEiC,UAAUC,UAAS,SAASC,OAEZ,OADCA,MAAMC,QAAUD,MAAMC,QAAUD,MAAME,QAE7CrC,EAAE,gBAAgBsC,QAClBtC,EAAE,gBAAgBuC,SAASC,OAAOV,KAAK,oBAAoBW"}